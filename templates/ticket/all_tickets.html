{% extends 'base.html' %}
{% load static %}

{% block content %}

    <div class="container mt-5">
  <div class="header-box"> <!-- New header section -->
    <h1 class="header-title">Tickets app</h1>
    <nav class="breadcrumb">
      <a class="breadcrumb-item" href="#">Home</a>
      <span class="breadcrumb-item active">Tickets</span>
        <img src="{% static 'images/breadcrumb.png' %}" alt="Ticket Icon" class="header-icon" style="height: 165px" >
    </nav>
  </div>
    
<div class="container mt-5">
  <div class="content-box"> <!-- New div for the box -->

    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">Are you sure you want to delete this ticket?</div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-danger" id="confirmDelete">Delete</button>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <div class="container mt-3">
          <div class="row">
            <!-- Total Tickets -->
            <div class="col-md-3 mb-4">
              <div class="card text-center bg-total-tickets ticket-card">
                <div class="card-body ticket-card-body">
                  <p class="card-number ticket-card-number mb-0">{{ total_tickets }}</p>
                  <h5 class="card-title ticket-card-title mt-0">Total Tickets</h5>
                </div>
              </div>
            </div>

            <!-- Pending Tickets -->
            <div class="col-md-3 mb-4">
              <div class="card text-center bg-pending-tickets ticket-card">
                <div class="card-body ticket-card-body">
                  <p class="card-number ticket-card-number mb-0">{{ pending_tickets }}</p>
                  <h5 class="card-title ticket-card-title mt-0">Pending Tickets</h5>
                </div>
              </div>
            </div>

            <!-- Open Tickets -->
            <div class="col-md-3 mb-4">
              <div class="card text-center bg-open-tickets ticket-card">
                <div class="card-body ticket-card-body">
                  <p class="card-number ticket-card-number mb-0">{{ open_tickets }}</p>
                  <h5 class="card-title ticket-card-title mt-0">Open Tickets</h5>
                </div>
              </div>
            </div>

            <!-- Closed Tickets -->
            <div class="col-md-3 mb-4">
              <div class="card text-center bg-closed-tickets ticket-card">
                <div class="card-body ticket-card-body">
                  <p class="card-number ticket-card-number mb-0">{{ closed_tickets }}</p>
                  <h5 class="card-title ticket-card-title mt-0">Closed Tickets</h5>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <label for="searchInput"></label>
      <input type="text" id="searchInput" onkeyup="searchTable()" placeholder="Caută după titlu.." class="form-control mb-2" />

      <div class="table-responsive">
        <table class="table table-bordered table-hover" id="ticketTable">
          <thead class="thead-light">
            <tr>
              <th scope="col">ID Ticket</th>
              <th scope="col">Titlu</th>
              <th scope="col">Creat la</th>
              <th scope="col">Atribuit către</th>
              <th scope="col">Prioritate</th>
              <th scope="col">Categorie</th>
              <th scope="col">Stare</th>
              <th scope="col">Acțiune</th>
            </tr>
          </thead>
          <tbody>
            {% for ticket in tickets %}
            <tr>
              <td><small>{{ ticket.ticket_number }}</small></td>
              <td><small>{{ ticket.title }}</small></td>
              <td><small>{{ ticket.date_created }}</small></td>
              <td>
                {% if ticket.assigned_to %}
                <img src="{{ ticket.assigned_to.profile_image.url }}" alt="Profile Image of {{ ticket.assigned_to.username }}" class="profile-image">
                <small>{{ ticket.assigned_to.username }}</small>
                {% else %}
                <small>Not Assigned</small>
                {% endif %}
              </td>
              <td>
                <!-- Apply badge styles based on priority -->
                {% if ticket.priority == 'Very Low' %}
                <span class="badge badge-very-low">Very Low</span>
                {% elif ticket.priority == 'Low' %}
                <span class="badge badge-low">Low</span>
                {% elif ticket.priority == 'Medium' %}
                <span class="badge badge-medium">Medium</span>
                {% elif ticket.priority == 'High' %}
                <span class="badge badge-high">High</span>
                {% elif ticket.priority == 'Very High' %}
                <span class="badge badge-very-high">Very High</span>
                {% endif %}
              </td>
              <td><small>{{ ticket.get_category_display }}</small></td>
              <td>
                {% if ticket.ticket_status == 'Active' %}
                <span class="badge badge-open">Open</span>
                {% elif ticket.ticket_status == 'Pending' %}
                <span class="badge badge-pending">Pending</span>
                {% elif ticket.ticket_status == 'Completed' %}
                <span class="badge badge-closed">Closed</span>
                {% endif %}
              </td>
              <td>
                <a href="{% url 'ticket-details' ticket.pk %}" class="btn btn-view btn-sm" title="Details">
                  <i class="bi bi-eye-fill"></i>
                </a>
                <a href="{% url 'update-ticket' ticket.pk %}" class="btn btn-edit btn-sm" title="Edit">
                  <i class="bi bi-pencil-fill"></i>
                </a>
                <a href="#" class="btn btn-delete btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal" data-ticket-id="{{ ticket.pk }}" title="Delete">
                  <i class="bi bi-trash-fill"></i>
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        
        <div class="pagination-container">
          <nav aria-label="Page navigation example">
            <ul class="pagination">
              {% if tickets.has_previous %}
              <li class="page-item"><a class="page-link" href="?page={{ tickets.previous_page_number }}">‹</a></li>
              {% else %}
              <li class="page-item disabled"><span class="page-link">‹</span></li>
              {% endif %}

              {% for num in tickets.paginator.page_range %}
              {% if num > tickets.number|add:'-4' and num < tickets.number|add:'4' %}
              {% if tickets.number == num %}
              <li class="page-item active"><a class="page-link" href="#">{{ num }}</a></li>
              {% else %}
              <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
              {% endif %}
              {% endif %}
              {% endfor %}

              {% if tickets.has_next %}
              <li class="page-item"><a class="page-link" href="?page={{ tickets.next_page_number }}">›</a></li>
              {% else %}
              <li class="page-item disabled"><span class="page-link">›</span></li>
              {% endif %}
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock content %}
