{% extends 'base.html' %} {% block content %}

<div class="container mt-5">
  <div
    class="modal fade"
    id="deleteModal"
    tabindex="-1"
    aria-labelledby="deleteModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete this ticket?
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button type="button" class="btn btn-danger" id="confirmDelete">
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">

      <div class="container mt-3">
        <div class="row">
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body">
                        <h5 class="card-title">Total Tickets</h5>
                        <p class="card-text">{{ total_tickets }}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-warning text-white">
                    <div class="card-body">
                        <h5 class="card-title">Pending Tickets</h5>
                        <p class="card-text">{{ pending_tickets }}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white">
                    <div class="card-body">
                        <h5 class="card-title">Open Tickets</h5>
                        <p class="card-text">{{ open_tickets }}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <h5 class="card-title">Closed Tickets</h5>
                        <p class="card-text">{{ closed_tickets }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
        <label for="searchInput"></label><input
        type="text"
        id="searchInput"
        onkeyup="searchTable()"
        placeholder="Caută după titlu.."
        class="form-control mb-2"
      />
      <div class="table-responsive">
        <table class="table table-bordered table-hover" id="ticketTable">
          <thead class="thead-light">
            <tr>
              <th scope="col">ID Ticket</th>
              <th scope="col">Titlu</th>
              <th scope="col">Creat la</th>
              <th scope="col">Atribuit către</th>
              <th scope="col">Prioritate</th>
              <th scope="col">Categorie</th>
              <th scope="col">Stare</th>
              <th scope="col">Acțiune</th>
            </tr>
          </thead>
          <tbody>
            {% for ticket in tickets %}
            <tr>
              <td><small>{{ticket.ticket_number}}</small></td>
              <td><small>{{ticket.title}}</small></td>
              <td><small>{{ticket.date_created}}</small></td>
              <td>
                {% if ticket.assigned_to %}
                <img
                  src="{{ ticket.assigned_to.profile_image.url }}"
                  alt="Profile Image of {{ ticket.assigned_to.username }}"
                  class="profile-image"
                />
                <small>{{ ticket.assigned_to.username }}</small>
                {% else %}
                <small>Nu este atribuit</small>
                {% endif %}
              </td>
              <td><small>{{ ticket.get_priority_display }}</small></td>
              <td><small>{{ ticket.get_category_display }}</small></td>
              {% if ticket.ticket_status == 'Active' %}
              <td><span class="badge bg-success">Activ</span></td>
              {% elif ticket.ticket_status == 'Pending' %}
              <td><span class="badge bg-warning">În așteptare</span></td>
              {% elif ticket.ticket_status == 'Completed' %}
              <td><span class="badge bg-danger">Finalizat</span></td>
              {% endif %}
              <td>
                <a
                  href="{% url 'ticket-details' ticket.pk %}"
                  class="btn btn-info btn-sm"
                  title="Detalii"
                >
                  <i class="bi bi-eye-fill"></i>
                </a>
                <a
                  href="{% url 'update-ticket' ticket.pk %}"
                  class="btn btn-primary btn-sm"
                  title="Editează"
                >
                  <i class="bi bi-pencil-fill"></i>
                </a>
                <a
                  href="#"
                  class="btn btn-danger btn-sm"
                  data-bs-toggle="modal"
                  data-bs-target="#deleteModal"
                  data-ticket-id="{{ ticket.pk }}"
                  title="Șterge"
                >
                  <i class="bi bi-trash-fill"></i>
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

{% endblock content %}
